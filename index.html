import csv
import pandas as pd
import numpy as np
from docx import Document
from docx.shared import Inches


# making docx for easier review of text.
document = Document()




data = pd.read_csv('data.csv')

org_lookup = pd.read_csv('org_lookup.csv')

with open("index.html", "w", encoding="utf-8") as file:
    # Head, Title, Blurb
    file.write(f'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>Fund the Resistance</title>\n<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">\n<link rel="stylesheet" href="styles.css">\n</head>\n<body>\n<div class="container">\n<h1 class="pop-title">FUND THE RESISTANCE</h1>\n<p class="blurb">The Trump administration thinks it can ignore settled law and precedent. Individuals and organizations are challenging these actions in court. But litigation costs money. Here we present current cases and provide links to the websites of the organizations pursuing these cases. You can support the resistance by helping to fund their litigation.<br><br>The source for this project is <a href="www.courtlistener.com">www.courtlistener.com</a>.<br>contact@resistancefund.net</p>\n<div class="button-container">\n<div class="row row-1">')
    
    document.add_heading('Fund the Resistance', 0)
    # Category buttons
    topic_num = 1
    for category in data['Category'].unique()[:3]:
        file.write(f'\n<a href="#topic{topic_num}"><button class="btn">{category}</button></a>\n')
        topic_num +=1
    file.write('\n</div>\n<div class="row row-2">')
    for category in data['Category'].unique()[3:]:
        file.write(f'\n<a href="#topic{topic_num}"><button class="btn">{category}</button></a>\n')
        topic_num +=1
    file.write('\n</div>\n</div>\n')

    # Topic boxes
    topic_num = 1
    for category in data['Category'].unique():
        file.write(f'<div id="topic{topic_num}" class="topic-section">\n')
        file.write(f'<h2>{category}</h2>\n')
        document.add_heading(f'{category}', level=1)

        # Sub Category Box
        subtopic_num = 1
        for subcat in data[data['Category'] == category]['Subcategory'].unique():
            file.write(f'<div id="subtopic{topic_num}-{subtopic_num}" class="subtopic-section">\n')
            file.write(f'<h3>{subcat}</h3>\n')
            file.write('<div class="organization">\n<ul>\n')
            document.add_heading(f'{subcat}', level=2)


            # Case Box
            for docket_id in data[(data['Category'] == category) & (data['Subcategory'] == subcat)]['Docket ID'].unique():
                link = data[data['Docket ID'] == docket_id]['Case Link'].values[0]
                case_name = data[data['Docket ID'] == docket_id]['Case Name'].values[0]
                case_summary = data[data['Docket ID'] == docket_id]['Case Summary'].values[0]
                parties = data[data['Docket ID'] == docket_id]['Party Name'].unique()
                orgs = np.append(data[data['Docket ID'] == docket_id]['Organization ID'].unique(), parties)
                file.write(f'<li class="case-item"><a class="case-link" href="{link}" target="_blank">{case_name}</a></li>\n')
                file.write(f'<p>{case_summary}</p>\n')
                document.add_heading(f'{case_name}', level = 3)
                document.add_paragraph(f'{docket_id}')
                document.add_paragraph(f'{case_summary}')

                # donate buttons
                file.write(f'<div class="donate-button-container">')
                org_names = []
                for organization_id in orgs:
                    organization_id = organization_id.upper()
                    org_name = org_lookup[org_lookup['Organization ID']==organization_id]['Organization Name'].values[0]
                    
                    donate_link = org_lookup[org_lookup['Organization ID']==organization_id]['Donate Link'].values[0]
                    if donate_link == "None":
                        continue
                    else:
                        if org_name not in org_names:
                            file.write(f'\n<a href="{donate_link}" target="_blank"><button class="donate-btn">{org_name}</button></a>\n')
                    org_names.append(org_name)
                file.write(f'</div class="donate-button-container">')

            file.write('</ul>\n</div>\n')  # Closes .organization
            file.write('</div>\n')  # Closes .subtopic-section
            subtopic_num += 1
        
        file.write('</div>\n')  # Closes .topic-section
        topic_num += 1
    
    file.write('</div>\n</body>\n</html>')
    document.save('Case Text.docx')

